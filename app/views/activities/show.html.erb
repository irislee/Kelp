<section class='section-wrapper stripped'>
  <div class='container'>
    <p id="notice"><%= notice %></p>
    <div class="activity clearfix">
    <h3 class='section-header'><%= @activity.name %></h3>

    <p>
      <img src="http://kids.media.timeout.com/images/<%= @activity.image %>/150/113/image.jpg">
    </p>

    <span id="star"></span>
    <div class="info">
    <p><%= @activity.location %> | <a href= "<%= @activity.url %>" target="_blank"><%= @activity.url %></a></p>

    <p>
      <%= @activity.blurb %>
    </p>
    <p><strong>Categories:</strong>
      <a href="/neighborhood/<%= @activity.neighborhood.to_s.gsub(" ", "-") %>"><button type="button" class="btn btn-primary btn-xs"><%= @activity.neighborhood %></button></a>
      <% @activity.category_list.split(",").each do |category| %>
                  <a href="/category/<%= CGI.escape(category) %>"><button type="button" class="btn btn-success btn-xs"><%= category %></button></a>
                <% end %><p>
    </p>
  </div>
  </div>
    <%#= link_to 'Edit', edit_activity_path(@activity) %>
  </div>
</section>

<% if current_user %>
  <div class="container">
  Your rating: <span id="user_star"></span>
    <%= form_for(@review) do |f| %>
    <% if @review.errors.any? %>
      <div id="error_explanation">
        <h2><%= pluralize(@review.errors.count, "error") %> prohibited this review from being saved:</h2>

        <ul>
        <% @review.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
        </ul>
      </div>
    <% end %>

    <div class="field">
      <%= f.hidden_field :user_id %>
    </div>
    <div class="field">
      <%= f.hidden_field :activity_id %>
    </div>
    <div class="field">
      <%= f.label "Review This Activity" %><br>
      <%= f.text_area :review_text, :cols => "150", :rows => "5" %>
    </div>
    <div class="actions">
      <%= f.submit %>
    </div>
  <% end %>
  </div>
<% end %>

<div class="container">
  <% @activity.reviews.reject{|review| review.review_text.nil?}.each do |review| %>
    <p><strong><%= review.user.name %> says:</strong>
    <%= review.review_text %><br></p>
    <p>
      <p>
        <%= link_to "Agree", review_upvote_path(review), {:class => "btn btn-info btn-xs"} %>
        <%= link_to "Disagree", review_downvote_path(review), {:class => "btn btn-warning btn-xs"} %>
        <%= number_to_percentage((review.likes.size.to_f/review.votes.size.to_f)*100, precision: 0) %> of people agreed with this review.
      </p>
    </p>
    <hr>
  <% end %>
</div>

<script>
  $('#star').raty({
    readOnly: true,
    score: <%= @activity.average_rating %>,
    path: '/assets'
  });

<% if current_user %>
  $('#user_star').raty({
    score: <%= @rating.score %>,
    path: '/assets',
    click: function(score, evt) {
      $.ajax({
        url: '/ratings/' + <%= @rating.id %>,
        type: 'PATCH',
        data: { score: score }
      });
    }
  });
<% end %>
</script>